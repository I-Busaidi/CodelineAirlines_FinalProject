@page "/manageAirplanes"
@layout Layout.AdminLayout
@inject IAirportService airportService
@inject IAirplaneService airplaneService
@inject NavigationManager NavigationManager
@using MudBlazor

@* @attribute [Authorize(Roles = "admin")] *@

<MudContainer Class="airplanes-container">
    <!-- Dropdown to Select an Airport -->
    <MudGrid>
        <MudItem xs="12" md="6" lg="4">
            <MudSelect T="int" Label="Select Airport" FullWidth="true" Variant="Variant.Outlined" ValueChanged="LoadAirplanes">
                @foreach (var airport in airports)
                {
                    <MudSelectItem Value="@airport.AirportId">@airport.AirportName (@airport.City)</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
    </MudGrid>

    <!-- Display Airplanes for Selected Airport -->
    <MudExpansionPanels Class="mt-4">
        @if (selectedAirportAirplanes != null && selectedAirportAirplanes.Any())
        {
            @foreach (var airplane in selectedAirportAirplanes)
            {
                string header = $"ID: {airplane.AirplaneId} | {airplane.AirplaneModel}";
                <MudExpansionPanel Text="@header">
                    <MudCard>
                        <MudCardContent>
                            <MudText Typo="Typo.body1" Class="mb-2">
                                <strong>Model:</strong> @airplane.AirplaneModel
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Manufacturer:</strong> @airplane.ManufactureDate
                            </MudText>
                        </MudCardContent>
                    </MudCard>
                </MudExpansionPanel>
            }
        }
        else if (selectedAirportId != null)
        {
            <MudText Typo="Typo.body2" Class="text-center">No airplanes available for the selected airport.</MudText>
        }
    </MudExpansionPanels>

    <!-- Add Airplane Button -->
    <MudGrid Class="mt-4">
        <MudItem xs="12" md="6" lg="4">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="NavigateToAddAirplanePage" FullWidth="true" Class="mb-2">
                Add Airplane
            </MudButton>
        </MudItem>
   

     <!-- Back Button -->
   
        <MudItem xs="12" md="6" lg="4">
            <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="NavigateToPreviousPage" FullWidth="true">
                Return
            </MudButton>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private List<AirportOutputDTO> airports = new List<AirportOutputDTO>();
    private List<AirplaneOutputDto> airplanes = new List<AirplaneOutputDto>();
    private List<AirplaneOutputDto> selectedAirportAirplanes = new List<AirplaneOutputDto>();
    private int selectedAirportId;

    // Load all airports on initialization
    protected override void OnInitialized()
    {
        airports = airportService.GetAllAirports(); // Fetch all airports from the service
        airplanes = airplaneService.GetAll();
    }

    // Load airplanes for the selected airport
    private void LoadAirplanes(int airportId)
    {
        selectedAirportAirplanes = airplanes.Where(a => a.CurrentAirportId == airportId).ToList(); // Fetch airplanes for the selected airport
        selectedAirportId = airportId;
    }
    // Navigate to the Add Airplane page
    private void NavigateToAddAirplanePage()
    {
        NavigationManager.NavigateTo($"/AddAirplanes");
    }

    // Navigate back to the previous page
    private void NavigateToPreviousPage()
    {
        NavigationManager.NavigateTo("/AdminHomePage");
    }
}

<style>
    .airplanes-container {
        padding: 20px;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .airplane-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .airplane-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

    .mt-4 {
        margin-top: 20px;
    }

    .mb-3 {
        margin-bottom: 16px;
    }

    .mb-2 {
        margin-bottom: 10px;
    }

    .text-center {
        text-align: center;
    }
</style>